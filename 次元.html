<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¬¡å…ƒèµ„æº</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Roboto, sans-serif; background: #f5f7fa; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        /* å…¬å‘Šæ  */
        .notice { background: #e8f4f8; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center; color: #2d3748; }
        /* ç™»å½•/æ³¨å†Œé¢æ¿ */
        .auth-panel { max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.1); }
        .auth-tabs { display: flex; margin-bottom: 25px; border-bottom: 1px solid #eee; }
        .auth-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-weight: 600; color: #999; }
        .auth-tab.active { color: #4299e1; border-bottom: 2px solid #4299e1; }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .auth-btn { width: 100%; padding: 12px; background: #4299e1; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        /* å¤´éƒ¨ */
        .header { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; margin-bottom: 25px; }
        .header h1 { flex: 1; min-width: 200px; color: #2d3748; }
        .search-box { flex: 2; min-width: 250px; position: relative; }
        .search-input { width: 100%; padding: 12px 15px 12px 40px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; }
        .user-info { flex: 1; min-width: 200px; text-align: right; }
        .points { font-weight: bold; color: #4299e1; }
        .points-btn { padding: 6px 12px; background: #48bb78; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 0 10px; }
        .logout-btn { padding: 6px 12px; background: #f56565; color: white; border: none; border-radius: 6px; cursor: pointer; }
        /* åˆ†ç±»å¯¼èˆª */
        .category-nav { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px; }
        .category-btn { padding: 10px 20px; border: none; border-radius: 8px; background: #fff; color: #4a5568; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .category-btn.active { background: #4299e1; color: white; }
        /* å†…å®¹ç½‘æ ¼ï¼ˆæ¯è¡Œ2ä¸ªï¼‰ */
        .content-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .content-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.08); transition: transform 0.3s; cursor: pointer; }
        .content-card:hover { transform: translateY(-3px); }
        .content-cover { width: 100%; height: 280px; background: #f0f0f0; background-size: cover; background-position: center; }
        .content-title { padding: 15px; text-align: center; font-weight: 600; }
        /* ç§¯åˆ†ä»»åŠ¡é¡µï¼ˆç‹¬ç«‹ï¼‰ */
        .points-page { background: white; border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); display: none; }
        .points-page h2 { margin-bottom: 20px; color: #2d3748; }
        .task-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        .task-item { padding: 15px; border: 1px solid #eee; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .task-btn { padding: 8px 16px; background: #48bb78; color: white; border: none; border-radius: 6px; cursor: pointer; }
        .task-btn.disabled { background: #ccc; cursor: not-allowed; }
        /* åå°æ ·å¼ */
        .admin-panel { display: none; }
        .form-row { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .form-col { flex: 1; min-width: 200px; }
        .upload-btn { background: #38b2ac; }
        .user-management { margin: 30px 0; }
        .user-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .user-table th, .user-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .user-table th { background: #f8f9fa; }
        .set-points-btn { padding: 6px 12px; background: #9f7aea; color: white; border: none; border-radius: 6px; cursor: pointer; }
        /* åº•éƒ¨æŒ‰é’® */
        .footer-btns { display: flex; gap: 15px; justify-content: center; margin: 20px 0; }
        .page-btn { padding: 10px 20px; border: none; border-radius: 8px; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: pointer; }
        .admin-entry { position: fixed; bottom: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%; background: #9f7aea; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); display: none; }
    </style>
</head>
<body>
    <!-- ç™»å½•/æ³¨å†Œé¢æ¿ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
    <div class="auth-panel" id="auth-panel">
        <div class="auth-tabs">
            <div class="auth-tab active" onclick="switchAuth('login')">ç™»å½•</div>
            <div class="auth-tab" onclick="switchAuth('register')">æ³¨å†Œ</div>
        </div>
        <!-- ç™»å½•è¡¨å• -->
        <div class="auth-form active" id="login-form">
            <div class="form-group">
                <label>ç”¨æˆ·å</label>
                <input type="text" class="form-control" id="login-username" placeholder="è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" class="form-control" id="login-pwd" placeholder="è¾“å…¥å¯†ç ">
            </div>
            <button class="auth-btn" onclick="userLogin()">ç™»å½•</button>
        </div>
        <!-- æ³¨å†Œè¡¨å• -->
        <div class="auth-form" id="register-form">
            <div class="form-group">
                <label>ç”¨æˆ·å</label>
                <input type="text" class="form-control" id="reg-username" placeholder="è®¾ç½®ç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" class="form-control" id="reg-pwd" placeholder="è®¾ç½®å¯†ç ">
            </div>
            <button class="auth-btn" onclick="userRegister()">æ³¨å†Œ</button>
        </div>
    </div>
    <!-- å‰å°é¡µé¢ï¼ˆç™»å½•åæ˜¾ç¤ºï¼‰ -->
    <div class="container" id="front-end" style="display: none;">
        <!-- å…¬å‘Šæ  -->
        <div class="notice" id="notice">æ¬¢è¿ä½¿ç”¨èµ„æºå¹³å°ï¼Œå®Œæˆä»»åŠ¡è·å–ç§¯åˆ†è§£é”å†…å®¹~</div>

        <!-- å¤´éƒ¨ï¼šæ ‡é¢˜+æœç´¢+ç”¨æˆ·ä¿¡æ¯ -->
        <div class="header">
            <h1>å¤šåª’ä½“èµ„æºå¹³å°</h1>
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="search-input" placeholder="æœç´¢æ ‡é¢˜...">
            </div>
            <div class="user-info">
                ç”¨æˆ·åï¼š<span id="current-username"></span> | 
                ç§¯åˆ†ï¼š<span class="points" id="user-points">0</span>
                <button class="points-btn" onclick="showPointsPage()">ç§¯åˆ†è·å–</button>
                <button class="logout-btn" onclick="userLogout()">é€€å‡º</button>
            </div>
        </div>
        <!-- åˆ†ç±»å¯¼èˆª -->
        <div class="category-nav">
            <button class="category-btn active" data-type="all">å…¨éƒ¨</button>
            <button class="category-btn" data-type="comic">æ¼«ç”»</button>
            <button class="category-btn" data-type="anime">åŠ¨æ¼«</button>
            <button class="category-btn" data-type="movie">ç”µå½±</button>
            <button class="category-btn" data-type="illustration">æ’ç”»</button>
            <button class="category-btn" data-type="video">åœ¨çº¿è§†é¢‘</button>
            <button class="category-btn" data-type="software">è½¯ä»¶</button>
        </div>
        <!-- å†…å®¹å±•ç¤ºåŒº -->
        <div class="content-grid" id="content-grid">
            <div style="grid-column: 1/3; text-align: center; padding: 50px; color: #999;">æš‚æ— å†…å®¹</div>
        </div>
        <!-- ç§¯åˆ†ä»»åŠ¡é¡µï¼ˆç‹¬ç«‹æ˜¾ç¤ºï¼‰ -->
        <div class="points-page" id="points-page">
            <h2>ç§¯åˆ†è·å–ä¸­å¿ƒ</h2>
            <div class="task-list" id="task-list">
                <!-- ä»»åŠ¡ç”±åå°è®¾ç½® -->
            </div>
            <button class="page-btn" onclick="showFrontPage()">è¿”å›èµ„æºé¦–é¡µ</button>
        </div>
    </div>
    <!-- åå°é¢æ¿ï¼ˆç®¡ç†å‘˜ç™»å½•åæ˜¾ç¤ºï¼‰ -->
    <div class="container admin-panel" id="admin-panel">
        <h2>ç®¡ç†å‘˜åå°</h2>
        <button class="page-btn" onclick="userLogout()">é€€å‡ºç™»å½•</button>
        <!-- å…¬å‘Šè®¾ç½® -->
        <div class="form-group">
            <label>å¹³å°å…¬å‘Š</label>
            <input type="text" class="form-control" id="notice-input" placeholder="è¾“å…¥å…¬å‘Šå†…å®¹">
        </div>
        <!-- å†…å®¹ä¸Šä¼  -->
        <div class="form-group">
            <h3>ä¸Šä¼ å†…å®¹</h3>
            <div class="form-row">
                <div class="form-col">
                    <label>å†…å®¹æ ‡é¢˜</label>
                    <input type="text" class="form-control" id="content-title" placeholder="è¾“å…¥æ ‡é¢˜">
                </div>
                <div class="form-col">
                    <label>å†…å®¹åˆ†ç±»</label>
                    <select class="form-control" id="content-type">
                        <option value="comic">æ¼«ç”»</option>
                        <option value="anime">åŠ¨æ¼«</option>
                        <option value="movie">ç”µå½±</option>
                        <option value="illustration">æ’ç”»</option>
                        <option value="video">åœ¨çº¿è§†é¢‘</option>
                        <option value="software">è½¯ä»¶</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <label>å°é¢å›¾ç‰‡URL</label>
                    <input type="text" class="form-control" id="content-cover" placeholder="è¾“å…¥å›¾ç‰‡é“¾æ¥">
                </div>
                <div class="form-col">
                    <label>è®¿é—®é“¾æ¥</label>
                    <input type="text" class="form-control" id="content-link" placeholder="è¾“å…¥è·³è½¬é“¾æ¥">
                </div>
            </div>
            <button class="auth-btn upload-btn" onclick="uploadContent()">ä¸Šä¼ å†…å®¹</button>
        </div>
        <!-- ä»»åŠ¡è®¾ç½® -->
        <div class="form-group">
            <h3>ç§¯åˆ†ä»»åŠ¡è®¾ç½®</h3>
            <div class="form-row">
                <div class="form-col">
                    <label>ä»»åŠ¡1åç§°</label>
                    <input type="text" class="form-control" id="task1-name" placeholder="è¾“å…¥ä»»åŠ¡åç§°" value="æ¯æ—¥ç­¾åˆ°">
                </div>
                <div class="form-col">
                    <label>ä»»åŠ¡1é“¾æ¥ï¼ˆç­¾åˆ°æ— éœ€å¡«å†™ï¼‰</label>
                    <input type="text" class="form-control" id="task1-link" placeholder="æ— éœ€å¡«å†™" disabled>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <label>ä»»åŠ¡2åç§°</label>
                    <input type="text" class="form-control" id="task2-name" placeholder="è¾“å…¥ä»»åŠ¡åç§°" value="é‚€è¯·å¥½å‹">
                </div>
                <div class="form-col">
                    <label>ä»»åŠ¡2é“¾æ¥</label>
                    <input type="text" class="form-control" id="task2-link" placeholder="è¾“å…¥è·³è½¬é“¾æ¥">
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <label>ä»»åŠ¡3åç§°</label>
                    <input type="text" class="form-control" id="task3-name" placeholder="è¾“å…¥ä»»åŠ¡åç§°" value="è§‚çœ‹å¹¿å‘Š">
                </div>
                <div class="form-col">
                    <label>ä»»åŠ¡3é“¾æ¥</label>
                    <input type="text" class="form-control" id="task3-link" placeholder="è¾“å…¥è·³è½¬é“¾æ¥">
                </div>
            </div>
            <button class="auth-btn" onclick="saveTasks()">ä¿å­˜ä»»åŠ¡</button>
        </div>
        <!-- ç”¨æˆ·ç®¡ç†ï¼ˆè®¾ç½®ç§¯åˆ†ï¼‰ -->
        <div class="user-management">
            <h3>ç”¨æˆ·ç®¡ç†</h3>
            <table class="user-table" id="user-table">
                <thead>
                    <tr>
                        <<th>ç”¨æˆ·å</</th>
                        <<th>å½“å‰ç§¯åˆ†</</th>
                        <<th>æ“ä½œ</</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ç”¨æˆ·åˆ—è¡¨ç”±ç³»ç»Ÿç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
    </div>
    <script>
        // åˆå§‹åŒ–ç³»ç»Ÿæ•°æ®ï¼ˆå¼ºåˆ¶æ›´æ–°ç®¡ç†å‘˜å¯†ç ï¼Œå…¼å®¹æ—§æ•°æ®ï¼‰
        const initSystemData = () => {
            const defaultData = {
                notice: 'æ¬¢è¿ä½¿ç”¨èµ„æºå¹³å°ï¼Œå®Œæˆä»»åŠ¡è·å–ç§¯åˆ†è§£é”å†…å®¹~',
                contents: [],
                tasks: [
                    { name: 'æ¯æ—¥ç­¾åˆ°', link: '#' },
                    { name: 'é‚€è¯·å¥½å‹', link: '#' },
                    { name: 'è§‚çœ‹å¹¿å‘Š', link: '#' }
                ],
                users: [
                    // ç®¡ç†å‘˜åˆå§‹å¯†ç è®¾ä¸º18046156515abc
                    { username: 'admin', password: '18046156515abc', role: 'admin', points: 9999, lastCheckinDate: '' }
                ],
                currentUser: null
            };

            if (!localStorage.getItem('platformSystem')) {
                // é¦–æ¬¡åˆå§‹åŒ–ï¼šç›´æ¥ç”¨æ–°å¯†ç 
                localStorage.setItem('platformSystem', JSON.stringify(defaultData));
            } else {
                // å·²æœ‰æ—§æ•°æ®ï¼šå¼ºåˆ¶æ›´æ–°ç®¡ç†å‘˜å¯†ç ï¼Œè¡¥å……ç¼ºå¤±å­—æ®µ
                const data = JSON.parse(localStorage.getItem('platformSystem'));
                // æ‰¾åˆ°ç®¡ç†å‘˜è´¦å·å¹¶æ›´æ–°å¯†ç 
                const adminIndex = data.users.findIndex(u => u.username === 'admin' && u.role === 'admin');
                if (adminIndex > -1) {
                    data.users[adminIndex].password = '18046156515abc'; // å¼ºåˆ¶è¦†ç›–æ—§å¯†ç 
                    data.users[adminIndex].lastCheckinDate = data.users[adminIndex].lastCheckinDate || '';
                } else {
                    // è‹¥ç®¡ç†å‘˜è´¦å·ä¸¢å¤±ï¼Œé‡æ–°æ·»åŠ 
                    data.users.push(defaultData.users[0]);
                }
                // ç»™æ‰€æœ‰ç”¨æˆ·è¡¥å……lastCheckinDateå­—æ®µ
                data.users = data.users.map(user => ({ ...user, lastCheckinDate: user.lastCheckinDate || '' }));
                saveSystemData(data);
            }
        };
        // æ•°æ®æ“ä½œå·¥å…·
        const getSystemData = () => JSON.parse(localStorage.getItem('platformSystem'));
        const saveSystemData = (data) => localStorage.setItem('platformSystem', JSON.stringify(data));
        // è·å–å½“å‰æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
        const getCurrentDate = () => {
            const date = new Date();
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        };
        // åˆ‡æ¢ç™»å½•/æ³¨å†Œè¡¨å•
        const switchAuth = (type) => {
            const loginTab = document.querySelectorAll('.auth-tab')[0];
            const regTab = document.querySelectorAll('.auth-tab')[1];
            const loginForm = document.getElementById('login-form');
            const regForm = document.getElementById('register-form');

            if (type === 'login') {
                loginTab.classList.add('active');
                regTab.classList.remove('active');
                loginForm.classList.add('active');
                regForm.classList.remove('active');
            } else {
                loginTab.classList.remove('active');
                regTab.classList.add('active');
                loginForm.classList.remove('active');
                regForm.classList.add('active');
            }
        };
        // ç”¨æˆ·æ³¨å†Œï¼ˆç”¨æˆ·åé‡å¤æç¤º"ç”¨æˆ·åå·²å­˜åœ¨"ï¼‰
        const userRegister = () => {
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-pwd').value.trim();
            if (!username || !password) return alert('ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©ºï¼');

            const data = getSystemData();
            const userExists = data.users.some(u => u.username === username);
            if (userExists) return alert('ç”¨æˆ·åå·²å­˜åœ¨');

            data.users.push({ username, password, role: 'user', points: 0, lastCheckinDate: '' });
            saveSystemData(data);
            alert('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
            switchAuth('login');
            document.getElementById('login-username').value = username;
        };
        // ç”¨æˆ·ç™»å½•ï¼ˆç²¾å‡†æç¤ºï¼šç”¨æˆ·åä¸å­˜åœ¨/å¯†ç é”™è¯¯ï¼‰
        const userLogin = () => {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-pwd').value.trim();
            if (!username || !password) return alert('ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©ºï¼');

            const data = getSystemData();
            // å…ˆåˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
            const user = data.users.find(u => u.username === username);
            if (!user) return alert('ç”¨æˆ·åä¸å­˜åœ¨ï¼');

            // ç”¨æˆ·åå­˜åœ¨ï¼Œåˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®
            if (user.password !== password) return alert('å¯†ç é”™è¯¯ï¼');

            // ç™»å½•æˆåŠŸ
            data.currentUser = user;
            saveSystemData(data);
            document.getElementById('auth-panel').style.display = 'none';
            if (user.role === 'admin') {
                document.getElementById('admin-panel').style.display = 'block';
                renderAdminPanel();
            } else {
                document.getElementById('front-end').style.display = 'block';
                renderFrontPage();
            }
        };
        // ç”¨æˆ·é€€å‡º
        const userLogout = () => {
            const data = getSystemData();
            data.currentUser = null;
            saveSystemData(data);
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('front-end').style.display = 'none';
            document.getElementById('auth-panel').style.display = 'block';
            document.getElementById('login-username').value = '';
            document.getElementById('login-pwd').value = '';
        };
        // æ¸²æŸ“å‰å°é¡µé¢
        const renderFrontPage = () => {
            const data = getSystemData();
            const currentUser = data.currentUser;
            document.getElementById('current-username').textContent = currentUser.username;
            document.getElementById('user-points').textContent = currentUser.points;
            document.getElementById('notice').textContent = data.notice;
            renderContents('all');
            renderTasks();
        };
        // æ¸²æŸ“å†…å®¹
        const renderContents = (type) => {
            const data = getSystemData();
            const grid = document.getElementById('content-grid');
            let contents = data.contents;
            if (type !== 'all') contents = contents.filter(item => item.type === type);
            const searchVal = document.getElementById('search-input').value.trim().toLowerCase();
            if (searchVal) contents = contents.filter(item => item.title.toLowerCase().includes(searchVal));

            grid.innerHTML = contents.length 
                ? contents.map(item => `
                    <div class="content-card" onclick="window.open('${item.link}', '_blank')">
                        <div class="content-cover" style="background-image: url('${item.cover || 'https://picsum.photos/400/600'}')"></div>
                        <div class="content-title">${item.title}</div>
                    </div>
                `).join('')
                : '<div style="grid-column: 1/3; text-align: center; padding: 50px; color: #999;">æš‚æ— å†…å®¹</div>';
        };
        // æ¸²æŸ“ç§¯åˆ†ä»»åŠ¡ï¼ˆæ–°å¢ç­¾åˆ°çŠ¶æ€åˆ¤æ–­ï¼‰
        const renderTasks = () => {
            const data = getSystemData();
            const currentUser = data.currentUser;
            const taskList = document.getElementById('task-list');
            const today = getCurrentDate();
            const hasCheckedIn = currentUser.lastCheckinDate === today;
            taskList.innerHTML = data.tasks.map((task, idx) => {
                // ä»»åŠ¡1ä¸ºæ¯æ—¥ç­¾åˆ°ï¼Œå•ç‹¬å¤„ç†
                if (idx === 0) {
                    return `
                        <div class="task-item">
                            <span>${idx+1}. ${task.name}ï¼ˆ+10ç§¯åˆ†/å¤©ï¼‰</span>
                            <button class="task-btn ${hasCheckedIn ? 'disabled' : ''}" onclick="${hasCheckedIn ? '' : 'checkin()'}">
                                ${hasCheckedIn ? 'ä»Šæ—¥å·²ç­¾åˆ°' : 'ç«‹å³ç­¾åˆ°'}
                            </button>
                        </div>
                    `;
                }
                // å…¶ä»–ä»»åŠ¡æ­£å¸¸æ¸²æŸ“
                return `
                    <div class="task-item">
                        <span>${idx+1}. ${task.name}</span>
                        <button class="task-btn" onclick="window.open('${task.link}', '_blank')">å»å®Œæˆ</button>
                    </div>
                `;
            }).join('');
        };
        // æ¯æ—¥ç­¾åˆ°åŠŸèƒ½ï¼ˆ+10ç§¯åˆ†ï¼Œæ¯æ—¥ä¸€æ¬¡ï¼‰
        const checkin = () => {
            const data = getSystemData();
            const currentUser = data.currentUser;
            const today = getCurrentDate();
            // å†æ¬¡éªŒè¯æ˜¯å¦å·²ç­¾åˆ°ï¼ˆé˜²æ­¢é‡å¤æäº¤ï¼‰
            if (currentUser.lastCheckinDate === today) {
                alert('ä»Šæ—¥å·²ç­¾åˆ°ï¼Œè¯·å‹¿é‡å¤æ“ä½œï¼');
                return;
            }
            // å¢åŠ 10ç§¯åˆ†ï¼Œæ›´æ–°ç­¾åˆ°æ—¥æœŸ
            currentUser.points += 10;
            currentUser.lastCheckinDate = today;
            // æ›´æ–°ç”¨æˆ·åˆ—è¡¨ä¸­çš„æ•°æ®
            const userIndex = data.users.findIndex(u => u.username === currentUser.username);
            data.users[userIndex] = currentUser;
            data.currentUser = currentUser;
            saveSystemData(data);
            alert('ç­¾åˆ°æˆåŠŸï¼è·å¾—10ç§¯åˆ†ï½');
            // åˆ·æ–°ç§¯åˆ†å’Œä»»åŠ¡çŠ¶æ€
            document.getElementById('user-points').textContent = currentUser.points;
            renderTasks();
        };
        // æ¸²æŸ“ç®¡ç†å‘˜é¢æ¿
        const renderAdminPanel = () => {
            const data = getSystemData();
            document.getElementById('notice-input').value = data.notice;
            document.getElementById('task1-name').value = data.tasks[0].name;
            document.getElementById('task2-name').value = data.tasks[1].name;
            document.getElementById('task2-link').value = data.tasks[1].link;
            document.getElementById('task3-name').value = data.tasks[2].name;
            document.getElementById('task3-link').value = data.tasks[2].link;
            renderUserList();
        };
        // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
        const renderUserList = () => {
            const data = getSystemData();
            const userTable = document.querySelector('#user-table tbody');
            userTable.innerHTML = data.users.map(user => `
                <tr>
                    <td>${user.username} ${user.role === 'admin' ? '(ç®¡ç†å‘˜)' : ''}</td>
                    <td>${user.points}</td>
                    <td>
                        <input type="number" placeholder="æ–°ç§¯åˆ†" class="form-control" style="width: 100px; display: inline-block; margin-right: 10px;" id="points-${user.username}">
                        <button class="set-points-btn" onclick="setUserPoints('${user.username}')">è®¾ç½®</button>
                    </td>
                </tr>
            `).join('');
        };
        // è®¾ç½®ç”¨æˆ·ç§¯åˆ†
        const setUserPoints = (username) => {
            const newPoints = parseInt(document.getElementById(`points-${username}`).value);
            if (isNaN(newPoints) || newPoints < 0) return alert('è¯·è¾“å…¥æœ‰æ•ˆç§¯åˆ†ï¼ˆéè´Ÿæ•´æ•°ï¼‰ï¼');

            const data = getSystemData();
            const userIndex = data.users.findIndex(u => u.username === username);
            data.users[userIndex].points = newPoints;
            if (data.currentUser?.username === username) data.currentUser.points = newPoints;
            saveSystemData(data);
            alert('ç§¯åˆ†è®¾ç½®æˆåŠŸï¼');
            renderUserList();
            if (document.getElementById('front-end').style.display === 'block') {
                document.getElementById('user-points').textContent = newPoints;
            }
        };
        // ä¸Šä¼ å†…å®¹
        const uploadContent = () => {
            const title = document.getElementById('content-title').value.trim();
            const type = document.getElementById('content-type').value;
            const cover = document.getElementById('content-cover').value.trim();
            const link = document.getElementById('content-link').value.trim();
            if (!title || !link) return alert('æ ‡é¢˜å’Œé“¾æ¥ä¸èƒ½ä¸ºç©ºï¼');

            const data = getSystemData();
            data.contents.push({ title, type, cover, link });
            saveSystemData(data);
            alert('ä¸Šä¼ æˆåŠŸï¼');
            document.getElementById('content-title').value = '';
            document.getElementById('content-cover').value = '';
            document.getElementById('content-link').value = '';
            if (document.getElementById('front-end').style.display === 'block') {
                renderContents(document.querySelector('.category-btn.active').dataset.type);
            }
        };
        // ä¿å­˜ä»»åŠ¡è®¾ç½®ï¼ˆç­¾åˆ°ä»»åŠ¡é“¾æ¥ç¦ç”¨ç¼–è¾‘ï¼‰
        const saveTasks = () => {
            const task1Name = document.getElementById('task1-name').value.trim() || 'æ¯æ—¥ç­¾åˆ°';
            const task2Name = document.getElementById('task2-name').value.trim() || 'é‚€è¯·å¥½å‹';
            const task2Link = document.getElementById('task2-link').value.trim() || '#';
            const task3Name = document.getElementById('task3-name').value.trim() || 'è§‚çœ‹å¹¿å‘Š';
            const task3Link = document.getElementById('task3-link').value.trim() || '#';

            const data = getSystemData();
            data.tasks = [
                { name: task1Name, link: '#' }, // ç­¾åˆ°ä»»åŠ¡é“¾æ¥å›ºå®šä¸º#
                { name: task2Name, link: task2Link },
                { name: task3Name, link: task3Link }
            ];
            saveSystemData(data);
            alert('ä»»åŠ¡ä¿å­˜æˆåŠŸï¼');
            if (document.getElementById('front-end').style.display === 'block') renderTasks();
        };
        // é¡µé¢åˆ‡æ¢ï¼šèµ„æºé¦–é¡µ/ç§¯åˆ†ä»»åŠ¡é¡µ
        const showFrontPage = () => {
            document.getElementById('content-grid').style.display = 'grid';
            document.querySelector('.category-nav').style.display = 'flex';
            document.getElementById('points-page').style.display = 'none';
        };
        const showPointsPage = () => {
            document.getElementById('content-grid').style.display = 'none';
            document.querySelector('.category-nav').style.display = 'none';
            document.getElementById('points-page').style.display = 'block';
        };
        // åˆ†ç±»åˆ‡æ¢äº‹ä»¶
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderContents(btn.dataset.type);
            });
        });
        // æœç´¢äº‹ä»¶
        document.getElementById('search-input').addEventListener('input', () => {
            const activeType = document.querySelector('.category-btn.active').dataset.type;
            renderContents(activeType);
        });
        // åˆå§‹åŒ–
        window.onload = () => {
            initSystemData();
            const data = getSystemData();
            if (data.currentUser) {
                document.getElementById('auth-panel').style.display = 'none';
                if (data.currentUser.role === 'admin') {
                    document.getElementById('admin-panel').style.display = 'block';
                    renderAdminPanel();
                } else {
                    document.getElementById('front-end').style.display = 'block';
                    renderFrontPage();
                }
            }
        };
    </script>
</body>
</html>
